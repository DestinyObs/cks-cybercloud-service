# Getting Started

## üìã Prerequisites

### Required Tools
- **AWS CLI**: Configured with appropriate credentials
- **Terraform**: Version >= 1.0
- **SSH Client**: For instance access
- **Git**: For cloning the repository

### AWS Requirements
- **AWS Account**: With appropriate permissions
- **IAM User/Role**: With EC2, VPC, IAM, and Budget permissions
- **Default VPC**: Available in target region
- **Key Pair**: For SSH access (auto-generated by Terraform)

### Permissions Required
```json
{
  "Version": "2012-10-17",
  "Statement": [
    {
      "Effect": "Allow",
      "Action": [
        "ec2:*",
        "iam:*",
        "budgets:*",
        "tls:*"
      ],
      "Resource": "*"
    }
  ]
}
```

## üöÄ Quick Setup

### 1. Clone Repository
```bash
git clone <repository-url>
cd naas-prod
```

### 2. Configure AWS CLI
```bash
aws configure
# Enter your AWS Access Key ID, Secret, Region, and Output format
```

### 3. Verify AWS Access
```bash
aws sts get-caller-identity
```

### 4. Configure Variables
```bash
cd infrastructure/live/staging
cp terraform.tfvars.example terraform.tfvars
```

Edit `terraform.tfvars`:
```hcl
aws_region     = "us-west-2"
environment    = "staging"
project_name   = "naas-prod"

# Network Configuration
vpc_cidr               = "172.31.0.0/16"
availability_zones     = ["us-west-2a", "us-west-2b"]
public_subnet_cidrs    = ["172.31.100.0/24", "172.31.101.0/24"]
private_subnet_cidrs   = ["172.31.110.0/24", "172.31.111.0/24"]

# Compute Configuration
master_instance_type = "t3.medium"
worker_instance_type = "t3.small"
master_count         = 1
worker_count         = 2

# Budget Configuration
budget_limit    = 50
alert_threshold = 80
alert_emails    = ["your-email@example.com"]
```

### 5. Deploy Infrastructure
```bash
# Initialize Terraform
terraform init

# Review deployment plan
terraform plan

# Deploy infrastructure
terraform apply
```

### 6. Access Your Cluster
```bash
# Get SSH command from Terraform output
terraform output ssh_command

# SSH to master node
ssh -i ./naas-prod-staging-key.pem ubuntu@<master-ip>
```

## üîß Initial Configuration

### On Master Node
```bash
# Check installation status
sudo tail -f /var/log/cloud-init-output.log

# Initialize Kubernetes cluster
sudo kubeadm init --pod-network-cidr=10.244.0.0/16

# Configure kubectl for ubuntu user
mkdir -p $HOME/.kube
sudo cp -i /etc/kubernetes/admin.conf $HOME/.kube/config
sudo chown $(id -u):$(id -g) $HOME/.kube/config

# Install CNI plugin (Flannel)
kubectl apply -f https://raw.githubusercontent.com/flannel-io/flannel/master/Documentation/kube-flannel.yml
```

### Join Worker Nodes
```bash
# On master, get join command
kubeadm token create --print-join-command

# On each worker node, run the join command
sudo kubeadm join <master-ip>:6443 --token <token> --discovery-token-ca-cert-hash <hash>
```

### Verify Cluster
```bash
# Check nodes
kubectl get nodes

# Check system pods
kubectl get pods -n kube-system
```

## üéØ What You Get

After successful deployment:

### Infrastructure
- ‚úÖ 1 Master node (t3.medium)
- ‚úÖ 2 Worker nodes (t3.small)
- ‚úÖ Security groups configured
- ‚úÖ SSH key pair generated
- ‚úÖ Budget alerts configured

### Kubernetes Components
- ‚úÖ containerd runtime
- ‚úÖ kubelet, kubeadm, kubectl installed
- ‚úÖ System configured for Kubernetes
- ‚úÖ Ready for cluster initialization

## üîç Verification Steps

### 1. Check Terraform Outputs
```bash
terraform output
```

### 2. Verify Instance Status
```bash
aws ec2 describe-instances --filters "Name=tag:Project,Values=naas-prod"
```

### 3. Test SSH Access
```bash
ssh -i ./naas-prod-staging-key.pem ubuntu@<master-ip> "kubectl version --client"
```

### 4. Check Budget Alerts
- Log into AWS Console
- Navigate to Billing & Cost Management > Budgets
- Verify budget is created with correct thresholds

## ‚ö†Ô∏è Common Issues

### Terraform Init Fails
```bash
# Clear Terraform cache
rm -rf .terraform
terraform init
```

### SSH Connection Refused
- Wait 2-3 minutes for instance initialization
- Check security group allows SSH from your IP
- Verify key file permissions: `chmod 400 *.pem`

### Cloud-init Still Running
```bash
# Check status
sudo cloud-init status

# View logs
sudo tail -f /var/log/cloud-init-output.log
```

## üìö Next Steps

1. **Configure Kubernetes**: Initialize cluster and join nodes
2. **Install CNI**: Deploy network plugin (Flannel recommended)
3. **Deploy Applications**: Start deploying your workloads
4. **Monitor Costs**: Check AWS billing dashboard regularly
5. **Backup Configuration**: Save kubeconfig and important files